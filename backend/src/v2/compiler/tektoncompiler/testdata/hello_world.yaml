apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  annotations:
    pipelines.kubeflow.org/v2_pipeline: "true"
    tekton.dev/artifact_bucket: mlpipeline
    tekton.dev/artifact_endpoint: minio-service.kubeflow:9000
    tekton.dev/artifact_endpoint_scheme: http://
  creationTimestamp: null
  generateName: hello-world-
  labels:
    pipeline-uid: a6ff13db-e038-4d8a-9bb0-415aa0816fee
    pipelines.kubeflow.org/v2_component: "true"
spec:
  pipelineSpec:
    tasks:
    - name: hello-world-driver
      params:
      - name: type
        value: CONTAINER
      - name: pipeline_name
        value: namespace/n1/pipeline/hello-world
      - name: run_id
        value: a6ff13db-e038-4d8a-9bb0-415aa0816fee
      - name: dag_execution_id
        value: $(tasks.root.results.execution-id)
      - name: component
        value: '{"executorLabel":"exec-hello-world","inputDefinitions":{"parameters":{"text":{"type":"STRING"}}}}'
      - name: task
        value: '{"cachingOptions":{"enableCache":true},"componentRef":{"name":"comp-hello-world"},"inputs":{"parameters":{"text":{"componentInputParameter":"text"}}},"taskInfo":{"name":"hello-world"}}'
      - name: container
        value: '{"args":["--text","{{$.inputs.parameters[''text'']}}"],"command":["sh","-ec","program_path=$(mktemp)\nprintf
          \"%s\" \"$0\" \u003e \"$program_path\"\npython3 -u \"$program_path\" \"$@\"\n","def
          hello_world(text):\n    print(text)\n    return text\n\nimport argparse\n_parser
          = argparse.ArgumentParser(prog=''Hello world'', description='''')\n_parser.add_argument(\"--text\",
          dest=\"text\", type=str, required=True, default=argparse.SUPPRESS)\n_parsed_args
          = vars(_parser.parse_args())\n\n_outputs = hello_world(**_parsed_args)\n"],"image":"python:3.7"}'
      - name: iteration_index
        value: ""
      - name: execution_id
        value: execution-id
      - name: executor_input
        value: executor-input
      - name: function_to_execute
        value: function-to-execute
      - name: cached_decision
        value: cached-decision
      - name: condition
        value: condition
      runAfter:
      - root-system-dag-driver
      taskRef:
        apiVersion: kfp-driver.tekton.dev/v1alpha1
        kind: KFPDriver
        name: kfp-driver
    - name: hello-world
      params:
      - name: executor-input
        value: $(tasks.hello-world-driver.results.executor-input)
      - name: execution-id
        value: $(tasks.hello-world-driver.results.execution-id)
      - name: function-to-execute
        value: $(tasks.hello-world-driver.results.function-to-execute)
      - name: run-id
        value: a6ff13db-e038-4d8a-9bb0-415aa0816fee
      runAfter:
      - hello-world-driver
      taskSpec:
        metadata:
          annotations:
            pipelines.kubeflow.org/v2_pipeline: "true"
          labels:
            pipeline-uid: a6ff13db-e038-4d8a-9bb0-415aa0816fee
            pipelines.kubeflow.org/v2_component: "true"
        params:
        - name: executor-input
          type: string
        - name: execution-id
          type: string
        - name: function-to-execute
          type: string
        - name: run-id
          type: string
        results:
        - description: execution id
          name: execution-id
        - description: executor input
          name: executor-input
        spec: null
        steps:
        - command:
          - launcher-v2
          - --copy
          - /tekton/home/launch
          image: gcr.io/ml-pipeline-test/dev/kfp-launcher-v2:latest
          imagePullPolicy: Always
          name: kfp-launcher
          resources: {}
        - args:
          - sh
          - -ec
          - |
            program_path=$(mktemp)
            printf "%s" "$0" > "$program_path"
            python3 -u "$program_path" "$@"
          - |
            def hello_world(text):
                print(text)
                return text

            import argparse
            _parser = argparse.ArgumentParser(prog='Hello world', description='')
            _parser.add_argument("--text", dest="text", type=str, required=True, default=argparse.SUPPRESS)
            _parsed_args = vars(_parser.parse_args())

            _outputs = hello_world(**_parsed_args)
          - --text
          - '{{$.inputs.parameters[''text'']}}'
          command:
          - /tekton/home/launch
          - --pipeline_name
          - namespace/n1/pipeline/hello-world
          - --run_id
          - $(params.run-id)
          - --execution_id
          - $(params.execution-id)
          - --executor_input
          - $(params.executor-input)
          - --pod_name
          - $(KFP_POD_NAME)
          - --pod_uid
          - $(KFP_POD_UID)
          - --mlmd_server_address
          - $(METADATA_GRPC_SERVICE_HOST)
          - --mlmd_server_port
          - $(METADATA_GRPC_SERVICE_PORT)
          - --executor_input
          - '{{$}}'
          - --function_to_execute
          - $(params.function-to-execute)
          - --
          env:
          - name: KFP_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: KFP_POD_UID
            valueFrom:
              fieldRef:
                fieldPath: metadata.uid
          - name: METADATA_GRPC_SERVICE_HOST
            value: metadata-grpc-service.kubeflow.svc.cluster.local
          - name: METADATA_GRPC_SERVICE_PORT
            value: "8080"
          envFrom:
          - configMapRef:
              name: metadata-grpc-configmap
              optional: true
          image: python:3.7
          name: user-main
          resources: {}
      when:
      - input: $(tasks.hello-world-driver.results.cached-decision)
        operator: in
        values:
        - "false"
    - name: root-system-dag-driver
      params:
      - name: type
        value: ROOT_DAG
      - name: pipeline_name
        value: namespace/n1/pipeline/hello-world
      - name: run_id
        value: a6ff13db-e038-4d8a-9bb0-415aa0816fee
      - name: dag_execution_id
        value: "0"
      - name: component
        value: '{"dag":{"tasks":{"hello-world":{"cachingOptions":{"enableCache":true},"componentRef":{"name":"comp-hello-world"},"inputs":{"parameters":{"text":{"componentInputParameter":"text"}}},"taskInfo":{"name":"hello-world"}}}},"inputDefinitions":{"parameters":{"text":{"type":"STRING"}}}}'
      - name: task
        value: ""
      - name: runtime_config
        value: '{"parameters":{"text":{"stringValue":"hi there"}}}'
      - name: iteration_index
        value: "-1"
      - name: execution_id
        value: execution-id
      - name: iteration_count
        value: iteration-count
      - name: condition
        value: condition
      taskRef:
        apiVersion: kfp-driver.tekton.dev/v1alpha1
        kind: KFPDriver
        name: kfp-driver
status: {}
